generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       String @id @default(cuid())
  name     String
  username String @unique
  email    String @unique
  password String

  isPremium      Boolean   @default(false)
  planExpiryDate DateTime?
  newsBalance    Int       @default(2)
  audioBalance   Int       @default(2)

  defaultCountry String @default("IN")

  comments Comment[]
  payments Payment[]

  avatarId String @default("cml8xib0r0000qe0tfrv7xyhc")
  avatar   File   @relation("avatar", fields: [avatarId], references: [id], onDelete: SetDefault)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([avatarId])
}

model File {
  id       String   @id @default(cuid())
  name     String
  url      String   @unique
  fileSize Float
  type     FileType

  isDefaultFile Boolean @default(false)

  createdAt DateTime @default(now())

  // Relations
  newsAudio   NewsData[] @relation("AudioFile")
  usersAvatar User[]     @relation("avatar")
}

model Payment {
  id       String        @id @default(cuid())
  stripeId String?       @unique
  userId   String
  amount   Float
  currency String        @default("INR")
  status   PaymentStatus
  provider String        @default("dodopay")

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model NewsData {
  id            String  @id @default(cuid())
  guardianId    String  @unique
  summarization String?

  audioFileId String?
  audioFile   File?   @relation("AudioFile", fields: [audioFileId], references: [id], onDelete: SetNull)

  comments Comment[]

  @@index([audioFileId])
}

model Comment {
  id      String @id @default(cuid())
  content String
  userId  String
  newsId  String

  createdAt DateTime @default(now())

  news NewsData @relation(fields: [newsId], references: [id], onDelete: Cascade)
  user User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([newsId])
}

enum FileType {
  image
  audio
}

enum PaymentStatus {
  success
  failed
  pending
}
